datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client"
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique               // Primary ID for Login
  username     String    @unique               // For the chat "Handle"
  name         String?
  password     String                          // Hashed with Argon2
  avatar       String?
  about        String    @default("Hey there! I am using this app.")
  
  // Auth Tracking (Ported from your sample logic)
  isVerified   Boolean   @default(false)
  verifyToken  String?
  verifyExpiry DateTime?
  
  // Real-time Presence
  isOnline     Boolean   @default(false)
  lastSeen     DateTime  @default(now())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  sentMessages Message[] @relation("SentBy")
  chats        Chat[]    @relation("UserChats")

  @@index([email, username]) // Optimized for searching contacts
}

model Chat {
  id          String    @id @default(cuid())
  isGroup     Boolean   @default(false)
  name        String?   // Only for groups
  groupAvatar String?   

  participants User[]    @relation("UserChats")
  messages     Message[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Message {
  id        String        @id @default(cuid())
  content   String? 
  fileUrl   String? 
  fileType  String?       
  status    MessageStatus @default(SENT)

  senderId  String
  sender    User          @relation("SentBy", fields: [senderId], references: [id])

  chatId    String
  chat      Chat          @relation(fields: [chatId], references: [id])

  createdAt DateTime      @default(now())

  @@index([chatId, createdAt])
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
}